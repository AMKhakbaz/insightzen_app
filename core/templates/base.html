<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightZen - {% block title %}Dashboard{% endblock %}</title>
    {% load static custom_tags %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500&family=Inter:wght@300;400;500;600&family=Vazirmatn:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="{% static 'core/css/styles.css' %}">
    {# Custom dark theme overrides #}
    <link rel="stylesheet" href="{% static 'core/css/theme.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css">
</head>
<body class="{% if lang == 'fa' %}rtl{% else %}ltr{% endif %}">
    <div class="wrapper">
        <aside class="sidebar" id="sidebar">
            {% render_sidebar %}
        </aside>
        <div class="sidebar-overlay" data-sidebar-overlay hidden aria-hidden="true"></div>
        <div class="main">
            <header class="header">
                <button id="menu-toggle" class="menu-toggle" type="button" aria-label="Toggle menu" aria-controls="sidebar">
                    <span class="sr-only">{% if lang == 'fa' %}تغییر وضعیت منو{% else %}Toggle menu{% endif %}</span>
                    <img src="{% static 'core/icons/opening and closing menu.svg' %}" alt="" aria-hidden="true" class="menu-toggle__icon menu-toggle__icon--open" data-menu-icon="open">
                    <img src="{% static 'core/icons/opening and closing menu.svg' %}" alt="" aria-hidden="true" class="menu-toggle__icon menu-toggle__icon--close" data-menu-icon="close">
                </button>
                <div class="brand">
                    <img src="{% static 'core/logo.png' %}" alt="InsightZen Logo" class="logo">
                    <span class="brand-name">InsightZen</span>
                </div>
                <div class="top-actions">
                    <div class="calendar-center">
                        <button type="button" class="calendar-toggle" data-calendar-toggle aria-haspopup="dialog" aria-expanded="false">
                            <span class="sr-only">{% if lang == 'fa' %}تقویم{% else %}Calendar{% endif %}</span>
                            <img src="{% static 'core/icons/taghvim.svg' %}" alt="" aria-hidden="true" class="calendar-toggle__icon">
                        </button>
                    </div>
                    <div id="notifications" class="notification-center" data-notification-root>
                        <button type="button" class="notification-toggle" data-notification-toggle aria-haspopup="true" aria-expanded="false">
                            <img src="{% static 'core/icons/notif.svg' %}" alt="" aria-hidden="true" class="notification-toggle__icon">
                            <span class="notification-badge" data-notification-count hidden>0</span>
                        </button>
                        <div class="notification-panel" data-notification-panel hidden>
                            <div class="notification-panel__header">
                                <span class="notification-panel__title" data-notification-title>
                                    {% if lang == 'fa' %}اعلان‌ها{% else %}Notifications{% endif %}
                                </span>
                                <button type="button" class="btn btn-text btn-sm" data-notification-mark-all>
                                    {% if lang == 'fa' %}علامت‌گذاری همه{% else %}Mark all{% endif %}
                                </button>
                            </div>
                            <div class="notification-panel__status" data-notification-status role="status" aria-live="polite"></div>
                            <div class="notification-panel__list" data-notification-list role="list"></div>
                            <div class="notification-panel__empty" data-notification-empty hidden>
                                {% if lang == 'fa' %}اعلان خوانده‌نشده‌ای وجود ندارد.{% else %}You're all caught up.{% endif %}
                            </div>
                        </div>
                    </div>
                    {% if lang == 'fa' %}
                        <a class="lang-btn" href="{% url 'toggle_language' 'en' %}">English</a>
                    {% else %}
                        <a class="lang-btn" href="{% url 'toggle_language' 'fa' %}">فارسی</a>
                    {% endif %}
                    {% if user.is_authenticated %}
                        <a class="btn btn-outline btn-sm" href="{% url 'logout' %}">
                            {% if lang == 'fa' %}خروج{% else %}Logout{% endif %}
                        </a>
                    {% endif %}
                </div>
            </header>
                <div class="page-content">
                    {% block breadcrumbs %}
                        {% include 'partials/breadcrumbs.html' %}
                    {% endblock %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
    <div class="calendar-panel" data-calendar-panel hidden>
        <div class="calendar-panel__backdrop" data-calendar-dismiss></div>
        <div class="calendar-panel__dialog" role="dialog" aria-modal="true" aria-labelledby="calendar-panel-title">
            <header class="calendar-panel__header">
                <div>
                    <p class="calendar-panel__eyebrow">{% if lang == 'fa' %}رویدادها و یادآورها{% else %}Events & reminders{% endif %}</p>
                    <h2 id="calendar-panel-title">{% if lang == 'fa' %}تقویم تیمی{% else %}Team calendar{% endif %}</h2>
                </div>
                <button type="button" class="calendar-panel__close" data-calendar-dismiss aria-label="{% if lang == 'fa' %}بستن تقویم{% else %}Close calendar{% endif %}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </header>
            <div class="calendar-panel__body">
                <div class="calendar-panel__layout">
                    <div class="calendar-panel__calendar" data-calendar-container></div>
                    <div class="calendar-panel__sidebar">
                        <form class="calendar-form" data-calendar-form>
                        <div class="calendar-form__status" data-calendar-status role="status" aria-live="polite"></div>
                        <label>
                            <span>{% if lang == 'fa' %}عنوان رویداد{% else %}Title{% endif %}</span>
                            <input type="text" name="title" required maxlength="255">
                        </label>
                        <label>
                            <span>{% if lang == 'fa' %}توضیحات{% else %}Description{% endif %}</span>
                            <textarea name="description" rows="3"></textarea>
                        </label>
                        <div class="calendar-form__grid">
                            <label>
                                <span>{% if lang == 'fa' %}شروع{% else %}Start{% endif %}</span>
                                <input type="datetime-local" name="start" required>
                            </label>
                            <label>
                                <span>{% if lang == 'fa' %}پایان{% else %}End{% endif %}</span>
                                <input type="datetime-local" name="end" required>
                            </label>
                        </div>
                        <label>
                            <span>{% if lang == 'fa' %}یادآور{% else %}Reminder{% endif %}</span>
                            <select name="reminder" data-calendar-reminder>
                                <option value="">{% if lang == 'fa' %}بدون یادآور{% else %}No reminder{% endif %}</option>
                                <option value="5">{% if lang == 'fa' %}۵ دقیقه قبل{% else %}5 minutes before{% endif %}</option>
                                <option value="15">{% if lang == 'fa' %}۱۵ دقیقه قبل{% else %}15 minutes before{% endif %}</option>
                                <option value="30">{% if lang == 'fa' %}۳۰ دقیقه قبل{% else %}30 minutes before{% endif %}</option>
                                <option value="60">{% if lang == 'fa' %}۱ ساعت قبل{% else %}1 hour before{% endif %}</option>
                                <option value="1440">{% if lang == 'fa' %}۱ روز قبل{% else %}1 day before{% endif %}</option>
                            </select>
                        </label>
                        <label>
                            <span>{% if lang == 'fa' %}شرکت‌کنندگان{% else %}Participants{% endif %}</span>
                            <select name="participants" data-calendar-participants multiple size="6"></select>
                            <small class="calendar-form__hint">{% if lang == 'fa' %}کاربران هم‌پروژه و اعضای سازمان در این فهرست نمایش داده می‌شوند.{% else %}Project teammates and organisation members appear here for quick invites.{% endif %}</small>
                        </label>
                        <div class="calendar-form__actions">
                            <button type="submit" class="btn btn-primary" data-calendar-save>{% if lang == 'fa' %}ذخیره رویداد{% else %}Save event{% endif %}</button>
                            <button type="button" class="btn btn-outline" data-calendar-reset>{% if lang == 'fa' %}ایجاد رویداد جدید{% else %}New event{% endif %}</button>
                            <button type="button" class="btn btn-text" data-calendar-delete hidden>{% if lang == 'fa' %}حذف رویداد{% else %}Delete event{% endif %}</button>
                        </div>
                        <p class="calendar-form__info">{% if lang == 'fa' %}روی خانه‌های تقویم کلیک کنید تا تاریخ‌ها انتخاب شوند یا یک رویداد موجود را برای ویرایش برگزینید.{% else %}Click a date range on the calendar to prefill this form or select an existing event to update it.{% endif %}</p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <template id="table-advanced-filter-template">
        <div class="table-advanced-filter" role="dialog" aria-modal="true" data-table-advanced-root hidden>
            <div class="table-advanced-filter__backdrop" data-advanced-dismiss="true"></div>
            <div class="table-advanced-filter__panel" role="document">
                <header class="table-advanced-filter__header">
                    <h2 class="table-advanced-filter__title" data-i18n="title"></h2>
                    <button type="button" class="table-advanced-filter__close" data-advanced-dismiss="true" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </header>
                <div class="table-advanced-filter__body">
                    <p class="table-advanced-filter__hint" data-i18n="hint"></p>
                    <div class="table-advanced-filter__logic">
                        <label>
                            <span data-i18n="logicLabel"></span>
                            <select data-advanced-logic></select>
                        </label>
                    </div>
                    <div class="table-advanced-filter__presets" data-advanced-presets hidden>
                        <label class="table-advanced-filter__presets-label">
                            <span data-i18n="savedLabel"></span>
                            <select data-advanced-preset-select></select>
                        </label>
                        <div class="table-advanced-filter__preset-actions">
                            <button type="button" class="btn btn-sm btn-secondary" data-advanced-load></button>
                            <button type="button" class="btn btn-sm btn-outline" data-advanced-delete></button>
                        </div>
                    </div>
                    <div class="table-advanced-filter__save" data-advanced-save>
                        <label class="table-advanced-filter__save-label">
                            <span data-i18n="saveLabel"></span>
                            <input type="text" data-advanced-save-name maxlength="150">
                        </label>
                        <button type="button" class="btn btn-sm btn-primary" data-advanced-save-button></button>
                        <p class="table-advanced-filter__save-hint" data-i18n="saveHint"></p>
                    </div>
                    <div class="table-advanced-filter__status" data-advanced-status role="status" aria-live="polite"></div>
                    <div class="table-advanced-filter__conditions" data-advanced-conditions></div>
                    <button type="button" class="btn btn-sm table-advanced-filter__add" data-advanced-add></button>
                </div>
                <footer class="table-advanced-filter__footer">
                    <button type="button" class="btn btn-primary" data-advanced-apply></button>
                    <button type="button" class="btn btn-outline" data-advanced-reset></button>
                    <button type="button" class="btn btn-text" data-advanced-cancel></button>
                </footer>
            </div>
        </div>
    </template>
    {% block extra_scripts %}{% endblock %}
    <script src="{% static 'core/js/scripts.js' %}"></script>
    <script src="{% static 'core/js/table.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales-all.global.min.js"></script>
    <script src="{% static 'core/js/calendar.js' %}"></script>
    {# Prefer locally bundled Chart.js and fall back to CDN if unavailable #}
    <script
        src="{% static 'core/js/vendor/chart.umd.min.js' %}"
        data-cdn-src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"
        data-cdn-integrity="sha384-V0nLmCBeWWog78ZFPUtAN0hYdR4P9J66yUfXJy3FxjsNuEzsAnfOq3+9Ky2i7c+5"
        onerror="(function(el){var s=document.createElement('script');s.src=el.dataset.cdnSrc;s.integrity=el.dataset.cdnIntegrity;s.crossOrigin='anonymous';document.head.appendChild(s);})(this);">
    </script>
    {# Custom UI interactions: sidebar persistence and accordion behaviour #}
    <script src="{% static 'core/js/ui.js' %}"></script>
</body>
</html>