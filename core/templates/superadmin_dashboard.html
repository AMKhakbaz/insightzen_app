{% extends 'base.html' %}
{% block title %}{% if lang == 'fa' %}داشبورد سوپراَد‌مین{% else %}Super Admin Dashboard{% endif %}{% endblock %}
{% block content %}
<div class="card superadmin-dashboard">
    <header class="card-header">
        <div>
            <h1 class="card-title">{% if lang == 'fa' %}داشبورد سوپراَد‌مین{% else %}Super Admin Dashboard{% endif %}</h1>
            <p class="card-subtitle">
                {% if lang == 'fa' %}
                    نمایی سریع از پروژه‌ها، اعضا و هشدارهای سامانه برای بررسی ادمین کل.
                {% else %}
                    A quick overview of projects, memberships, and global alerts for platform administrators.
                {% endif %}
            </p>
        </div>
    </header>
    <section class="superadmin-stats-grid">
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}کل پروژه‌ها{% else %}Total Projects{% endif %}</p>
            <p class="stat-value">{{ stats.projects_total }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}پروژه‌های فعال{% else %}Active Projects{% endif %}</p>
            <p class="stat-value">{{ stats.projects_active }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}پروژه‌های سررسید گذشته{% else %}Overdue Projects{% endif %}</p>
            <p class="stat-value stat-value--warning">{{ stats.projects_overdue }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}شروع طی ۱۴ روز{% else %}Starting Soon{% endif %}</p>
            <p class="stat-value">{{ stats.projects_starting_soon }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}سازمان‌ها{% else %}Organisations{% endif %}</p>
            <p class="stat-value">{{ stats.organisations_total }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}اعضا{% else %}Memberships{% endif %}</p>
            <p class="stat-value">{{ stats.memberships_total }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}پروژه بدون مالک{% else %}No Owner{% endif %}</p>
            <p class="stat-value stat-value--warning">{{ stats.projects_missing_owner }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}پروژه بدون سهمیه{% else %}No Quotas{% endif %}</p>
            <p class="stat-value stat-value--warning">{{ stats.projects_missing_quota }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}پاسخگویان ثبت‌شده{% else %}Respondents{% endif %}</p>
            <p class="stat-value">{{ stats.respondents_total }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}شماره‌های فعال{% else %}Mobiles{% endif %}</p>
            <p class="stat-value">{{ stats.mobiles_total }}</p>
        </article>
        <article class="stat">
            <p class="stat-label">{% if lang == 'fa' %}اعلان‌های خوانده‌نشده{% else %}Unread Notifications{% endif %}</p>
            <p class="stat-value">{{ stats.unread_notifications }}</p>
        </article>
    </section>

    {% if quick_actions %}
    <section class="superadmin-panel superadmin-quick-actions">
        <div class="superadmin-panel__header">
            <h2>{% if lang == 'fa' %}دسترسی سریع{% else %}Quick Actions{% endif %}</h2>
            <p class="muted">
                {% if lang == 'fa' %}
                    مسیرهای کلیدی برای مدیریت پروژه‌ها و اعضا.
                {% else %}
                    Jump directly to the management panels you open most.
                {% endif %}
            </p>
        </div>
        <div class="quick-actions-grid">
            {% for action in quick_actions %}
            <a href="{{ action.url }}" class="quick-action-card">
                <span class="quick-action-card__icon" aria-hidden="true"><i data-feather="{{ action.icon }}"></i></span>
                <span class="quick-action-card__label">{% if lang == 'fa' %}{{ action.label_fa }}{% else %}{{ action.label_en }}{% endif %}</span>
                <span class="quick-action-card__hint">{% if lang == 'fa' %}{{ action.description_fa }}{% else %}{{ action.description_en }}{% endif %}</span>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if projects_attention %}
    <section class="superadmin-panel attention-panel">
        <div class="superadmin-panel__header">
            <h2>{% if lang == 'fa' %}پروژه‌های نیازمند توجه{% else %}Projects Needing Attention{% endif %}</h2>
            <p class="muted">
                {% if lang == 'fa' %}
                    ترکیبی از ددلاین‌های گذشته، شروع‌های نزدیک و ناهماهنگی‌های پنل.
                {% else %}
                    Highlighted deadlines, upcoming starts, and panel anomalies.
                {% endif %}
            </p>
        </div>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>{% if lang == 'fa' %}نام{% else %}Name{% endif %}</th>
                        <th>{% if lang == 'fa' %}شروع{% else %}Start{% endif %}</th>
                        <th>{% if lang == 'fa' %}ددلاین{% else %}Deadline{% endif %}</th>
                        <th>{% if lang == 'fa' %}هشدارها{% else %}Alerts{% endif %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in projects_attention %}
                    <tr class="attention-row attention-row--{{ entry.severity }}">
                        <td><a href="{% url 'project_edit' entry.project.pk %}">{{ entry.project.name }}</a></td>
                        <td>{{ entry.project.start_date }}</td>
                        <td>{{ entry.project.deadline }}</td>
                        <td>
                            <ul class="attention-tags">
                                {% for reason in entry.reasons %}
                                <li class="attention-tag">{% if lang == 'fa' %}{{ reason.fa }}{% else %}{{ reason.en }}{% endif %}</li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">{% if lang == 'fa' %}موردی برای نمایش نیست.{% else %}Nothing to show.{% endif %}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    {% if alert_collections %}
    <section class="superadmin-panel alerts-panel">
        <div class="superadmin-panel__header">
            <h2>{% if lang == 'fa' %}هشدارهای کلیدی{% else %}Key Alerts{% endif %}</h2>
            <p class="muted">
                {% if lang == 'fa' %}
                    خلاصه‌ای از پروژه‌هایی که نیاز به اقدام فوری دارند.
                {% else %}
                    Snapshot of the projects that need fast follow-up.
                {% endif %}
            </p>
        </div>
        <div class="alert-card-grid">
            {% for alert in alert_collections %}
            <article class="alert-card">
                <p class="alert-card__label">{% if lang == 'fa' %}{{ alert.label_fa }}{% else %}{{ alert.label_en }}{% endif %}</p>
                <p class="alert-card__value">{{ alert.count }}</p>
                <ul class="alert-card__list">
                    {% if alert.items %}
                        {% for project in alert.items %}
                        <li><a href="{% url 'project_edit' project.pk %}">{{ project.name }}</a></li>
                        {% endfor %}
                    {% else %}
                        <li class="muted">{% if lang == 'fa' %}موردی نیست.{% else %}All good.{% endif %}</li>
                    {% endif %}
                </ul>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    <div class="superadmin-grid">
        <section class="superadmin-panel">
            <h2>{% if lang == 'fa' %}پروژه‌های اخیر{% else %}Recent Projects{% endif %}</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>{% if lang == 'fa' %}نام{% else %}Name{% endif %}</th>
                        <th>{% if lang == 'fa' %}شروع{% else %}Start{% endif %}</th>
                        <th>{% if lang == 'fa' %}ددلاین{% else %}Deadline{% endif %}</th>
                        <th>{% if lang == 'fa' %}منبع نمونه{% else %}Sample Source{% endif %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in recent_projects %}
                    <tr>
                        <td><a href="{% url 'project_edit' project.pk %}">{{ project.name }}</a></td>
                        <td>{{ project.start_date }}</td>
                        <td>{{ project.deadline }}</td>
                        <td>
                            {% if project.sample_source == 'upload' %}
                                {% if lang == 'fa' %}آپلود{% else %}Upload{% endif %}
                            {% else %}
                                {% if lang == 'fa' %}بانک پاسخگو{% else %}Respondent Bank{% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">{% if lang == 'fa' %}پروژه‌ای یافت نشد.{% else %}No projects found.{% endif %}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        <section class="superadmin-panel">
            <h2>{% if lang == 'fa' %}فعالیت‌های اخیر{% else %}Recent Activity{% endif %}</h2>
            <ul class="timeline">
                {% for log in recent_logs %}
                <li>
                    <strong>{{ log.timestamp|date:"Y-m-d H:i" }}</strong>
                    <div>
                        <span>{{ log.user }} — {{ log.action }}</span>
                        {% if log.details %}<p class="muted">{{ log.details }}</p>{% endif %}
                    </div>
                </li>
                {% empty %}
                <li>{% if lang == 'fa' %}لاگی ثبت نشده است.{% else %}No activity logs recorded.{% endif %}</li>
                {% endfor %}
            </ul>
        </section>
        <section class="superadmin-panel">
            <h2>{% if lang == 'fa' %}اعلان‌های خوانده‌نشده{% else %}Unread Notifications{% endif %}</h2>
            <ul class="notification-list">
                {% for notification in unread_notifications %}
                <li>
                    <div><strong>{{ notification.recipient }}</strong></div>
                    <p>{{ notification.message }}</p>
                    <span class="muted">{{ notification.created_at|date:"Y-m-d H:i" }}</span>
                </li>
                {% empty %}
                <li>{% if lang == 'fa' %}اعلان خوانده‌نشده‌ای وجود ندارد.{% else %}No unread notifications.{% endif %}</li>
                {% endfor %}
            </ul>
        </section>
    </div>
    <section class="superadmin-panel">
        <h2>{% if lang == 'fa' %}پنل‌ها و سطوح دسترسی{% else %}Panel Access Overview{% endif %}</h2>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>{% if lang == 'fa' %}پنل{% else %}Panel{% endif %}</th>
                        <th>{% if lang == 'fa' %}تعداد اعضای دارای دسترسی{% else %}Members with Access{% endif %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for panel in panel_overview %}
                    <tr>
                        <td>{% if lang == 'fa' %}{{ panel.label_fa }}{% else %}{{ panel.label_en }}{% endif %}</td>
                        <td>{{ panel.count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}
