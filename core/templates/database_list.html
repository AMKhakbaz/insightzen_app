{% extends 'base.html' %}
{% block title %}{% if lang == 'fa' %}مدیریت پایگاه داده{% else %}Database Management{% endif %}{% endblock %}

{% block content %}
<div class="card" style="max-width:1000px;margin:2rem auto;padding:1.5rem;">
    <h1 style="margin-bottom:1rem;">{% if lang == 'fa' %}مدیریت پایگاه داده{% else %}Database Management{% endif %}</h1>
    <p class="card-intro">
        {% if lang == 'fa' %}پس از پایان ددلاین هر پروژه، تنها مالک می‌تواند داده‌ها را مشاهده یا به‌روزرسانی کند.{% else %}Once a project's deadline passes, only the owner can view or update its cached data.{% endif %}
    </p>
    <div style="display:flex;justify-content:flex-start;align-items:center;margin-bottom:1rem;">
        <a href="{% url 'database_add' %}" class="btn btn-secondary">
            {% if lang == 'fa' %}افزودن پایگاه داده{% else %}Add Database{% endif %}
        </a>
    </div>
    <div class="table-responsive">
        <table id="database-table" class="table" data-table="interactive" data-filter-context="database_list" data-empty-text="{% if lang == 'fa' %}هیچ پایگاه داده‌ای مطابق فیلتر نیست.{% else %}No databases match your filters.{% endif %}" data-search-text="{% if lang == 'fa' %}در حال جست‌وجو…{% else %}Searching…{% endif %}">
            <thead>
                <tr>
                    <th scope="col">
                        <button type="button" class="table-sort" data-sort-column="0" data-sort-type="text">
                            <span>{% if lang == 'fa' %}پروژه{% else %}Project{% endif %}</span>
                            <span class="sort-icon" aria-hidden="true"></span>
                        </button>
                    </th>
                    <th scope="col">
                        <button type="button" class="table-sort" data-sort-column="1" data-sort-type="text">
                            <span>{% if lang == 'fa' %}نام پایگاه{% else %}DB Name{% endif %}</span>
                            <span class="sort-icon" aria-hidden="true"></span>
                        </button>
                    </th>
                    <th scope="col">
                        <button type="button" class="table-sort" data-sort-column="2" data-sort-type="text">
                            <span>{% if lang == 'fa' %}توکن{% else %}Token{% endif %}</span>
                            <span class="sort-icon" aria-hidden="true"></span>
                        </button>
                    </th>
                    <th scope="col">
                        <button type="button" class="table-sort" data-sort-column="3" data-sort-type="text">
                            <span>{% if lang == 'fa' %}شناسه دارایی{% else %}Asset ID{% endif %}</span>
                            <span class="sort-icon" aria-hidden="true"></span>
                        </button>
                    </th>
                    <th scope="col">
                        <button type="button" class="table-sort" data-sort-column="4" data-sort-type="text">
                            <span>{% if lang == 'fa' %}وضعیت{% else %}Status{% endif %}</span>
                            <span class="sort-icon" aria-hidden="true"></span>
                        </button>
                    </th>
                    <th scope="col">{% if lang == 'fa' %}اقدامات{% else %}Actions{% endif %}</th>
                </tr>
                <tr class="table-filter-row">
                    <th><input type="text" data-filter-column="0" placeholder="{% if lang == 'fa' %}نام پروژه{% else %}Project{% endif %}" autocomplete="off"></th>
                    <th><input type="text" data-filter-column="1" placeholder="{% if lang == 'fa' %}نام پایگاه{% else %}Database{% endif %}" autocomplete="off"></th>
                    <th><input type="text" data-filter-column="2" placeholder="{% if lang == 'fa' %}توکن{% else %}Token{% endif %}" autocomplete="off"></th>
                    <th><input type="text" data-filter-column="3" placeholder="{% if lang == 'fa' %}شناسه{% else %}Asset ID{% endif %}" autocomplete="off"></th>
                    <th><input type="text" data-filter-column="4" placeholder="{% if lang == 'fa' %}وضعیت{% else %}Status{% endif %}" autocomplete="off"></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td>{{ entry.project.name }}</td>
                    <td>{{ entry.db_name }}</td>
                    <td>{{ entry.token|truncatechars:15 }}</td>
                    <td>{{ entry.asset_id }}</td>
                    <td>{% if entry.status %}<span class="text-success">✓</span>{% else %}<span class="text-danger">×</span>{% endif %}</td>
                    <td>
                        <a href="{% url 'database_edit' entry.pk %}" class="btn btn-sm btn-secondary">
                            {% if lang == 'fa' %}ویرایش{% else %}Edit{% endif %}
                        </a>
                        <form action="{% url 'database_update' entry.pk %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline">{% if lang == 'fa' %}به‌روزرسانی{% else %}Update{% endif %}</button>
                        </form>
                        <form action="{% url 'database_delete' entry.pk %}" method="post" style="display:inline;" onsubmit="return confirm('{% if lang == 'fa' %}آیا مطمئن هستید؟{% else %}Are you sure?{% endif %}');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline">{% if lang == 'fa' %}حذف{% else %}Delete{% endif %}</button>
                        </form>
                        <a href="{% url 'database_view' entry.pk %}" class="btn btn-sm btn-outline">{% if lang == 'fa' %}نمایش داده‌ها{% else %}View Data{% endif %}</a>
                    </td>
                </tr>
                {% empty %}
                <tr data-empty-row><td colspan="6" class="text-center">{% if lang == 'fa' %}اطلاعاتی یافت نشد{% else %}No entries found{% endif %}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}